# syscall-monitor
Linux Kernel Module for monitoring and managing system calls generated by running processes.
## Table of contents
- [Functionality](#functionality)
  - [Supported syscall levels](#supported-syscall-levels)
    - [Level 1](#level-1)
    - [Level 2](#level-2)
    - [Level 3](#level-3)
 - [Building (e.g. Ubuntu 20.04)](#building-eg-ubuntu-2004)
   - [Build for the current system](#build-for-the-current-system)
   - [Build for the different Linux Kernel](#build-for-the-different-linux-kernel)
   - [Clean](#clean)
 - [Usage](#usage)
   - [Load module](#load-module)
   - [Unload module](#unload-module)
   - [Interacting with loaded module](#interacting-with-loaded-module)
     - [Read logs](#read-logs)
     - [startlogging](#startlogging)
     - [stoplogging](#stoplogging)
     - [setsyscalllevel](#setsyscalllevel)
     - [block](#block)
     - [unblock](#unblock)
## Functionality
The module can do the following:
- Start / stop syscall logging
- Change syscall level
- Block / unblock process execution
### Supported syscall levels
#### Level 1
- open
- openat
- write
- writev
- pwrite64
- pwritev
- pwritev2
#### Level 2
- chown
- lchown
- fchown
- fchownat
- chmod
- fchmod
- fchmodat
#### Level 3
- fork
- vfork
- execve
- execveat

## Building (e.g. Ubuntu 20.04)
Install a compiler, Linux headers and all other things required to build the module:
```sh
sudo apt update
sudo apt install build-essential
sudo apt install linux-headers-$(uname -r)
```
Move to the src directory:
```sh
cd src
```
### Build for the current system 
Compile with Makefile:
```sh
make
```
### Build for the different Linux Kernel
Use KERNEL_BUILD_DIR_PATH to specify kernel path:
```sh
make KERNEL_BUILD_DIR_PATH=/root/dev/linux-6.2.0/
```
### Clean
```sh
make clean
```

## Usage
### Load module
To insert the module into the kernel with the ability to unload, run:
```sh
make load
```
Without the ability to unload:
```sh
make load-non-unload
```
### Unload module
```sh
make unload
```
### Interacting with loaded module
The proc filesystem (procfs) is used to interact with the loaded module. \
File location:
```sh
/proc/syscallmonitor
```
#### Read logs
Read logs from the proc file:
```sh
cat /proc/syscallmonitor
```
#### startlogging
Start logging to the proc file:
```sh
echo startlogging > /proc/syscallmonitor
```
#### stoplogging
Stop logging to the proc file:
```sh
echo stoplogging > /proc/syscallmonitor
```
#### setsyscalllevel
Change logging syscall level (1, 2, 3):
```sh
echo setsyscalllevel [LEVEL] > /proc/syscallmonitor
```
#### block
Prohibit process execution:
```sh
echo block [PATH_TO_FILE] > /proc/syscallmonitor
```
#### unblock
Allow blocked process execution:
```sh
echo unblock [PATH_TO_FILE] > /proc/syscallmonitor
```
